## # `Symbols` -

- <mark style="background: #3D7EFFA6;">Debugging Symbols</mark> :

Symbol files permit WinDbg to reference internal functions, structures, and global variables using names instead of addresses. Configuring the symbols path allows WinDbg to fetch symbol files for native Windows executables and libraries from the official Microsoft symbol store.

We access the symbol settings through the ==File > Symbol File Path== or through command line set the symbol path to :

```c
SRV*c:\symbols*http://msdl.microsoft.com/download/symbols
```

Load it :

```c
.reload /f
```

---

## # `Diassembling` -

- <mark style="background: #3D7EFFA6;">Disassembling code forward</mark> :

It disassembles code from current EIP -

```c
u kernel32!GetCurrentThread
KERNEL32!GetCurrentThread:
770b5910 6afe push 0FFFFFFFEh
770b5912 58 pop eax
770b5913 c3 ret
770b5914 cc int 3
770b5915 cc int 3
770b5916 cc int 3
770b5917 cc int 3
770b5918 cc int 3
```

- <mark style="background: #FFB86CA6;">Disassemble code backward</mark> :

More like how we reach to the current EIP ; Backtracing -

```c
0:000> ub 00007ffd10ee0750
ntdll!LdrpDoDebuggerBreak+0x10:
00007ffd`10ee0730 4c8d442440      lea     r8,[rsp+40h]
00007ffd`10ee0735 418d5110        lea     edx,[r9+10h]
00007ffd`10ee0739 48c7c1feffffff  mov     rcx,0FFFFFFFFFFFFFFFEh
00007ffd`10ee0740 e89bcbfcff      call    ntdll!NtQueryInformationThread (00007ffd`10ead2e0)
00007ffd`10ee0745 85c0            test    eax,eax
00007ffd`10ee0747 780a            js      ntdll!LdrpDoDebuggerBreak+0x33 (00007ffd`10ee0753)
00007ffd`10ee0749 807c244000      cmp     byte ptr [rsp+40h],0
00007ffd`10ee074e 7503            jne     ntdll!LdrpDoDebuggerBreak+0x33 (00007ffd`10ee0753)
```

- <mark style="background: #D2B3FFA6;">Disassemble Function</mark> :

```c
:000> uf notepad!wWinMain
notepad!wWinMain:
00007ff7`4249ad1c 488bc4          mov     rax,rsp
00007ff7`4249ad1f 48895808        mov     qword ptr [rax+8],rbx
00007ff7`4249ad23 48897010        mov     qword ptr [rax+10h],rsi
00007ff7`4249ad27 48897818        mov     qword ptr [rax+18h],rdi
00007ff7`4249ad2b 4c896020        mov     qword ptr [rax+20h],r12
00007ff7`4249ad2f 55              push    rbp
00007ff7`4249ad30 4156            push    r14
00007ff7`4249ad32 4157            push    r15
<SNIP>
```

- <mark style="background: #E632B3A6;">What functions are being called</mark> :

```c
0:000> uf /c notepad!wWinMain
notepad!wWinMain (00007ff7`4249ad1c)
  notepad!wWinMain+0x41 (00007ff7`4249ad5d):
    call to notepad!wil::details::FeatureImpl<__WilFeatureTraits_Feature_LongPaths>::GetCachedFeatureEnabledState (00007ff7`4249ca90)
  notepad!wWinMain+0x92 (00007ff7`4249adae):
    call to notepad!wil::details::ReportUsageToService (00007ff7`4249ddf4)
  notepad!wWinMain+0xc1 (00007ff7`4249addd):
    call to KERNEL32!GetCommandLineWStub (00007ffd`0f52f6d0)
```

---

## # `Edit` -

- <mark style="background: #3D7EFFA6;">Simple edit command to modify a single DWORD :</mark>

```ruby
0:000> dd esp L1
003cb710 00000000
0:000> ed esp 41414141
0:000> dd esp L1
003cb710 41414141
```

---

- <mark style="background: #3D7EFFA6;">Write or modify ASCII characters :</mark>

```ruby
0:000> da esp
003cb710 ""
0:000> ea esp "Hello"
0:000> da esp
003cb710 "Hello"
```

---

- <mark style="background: #3D7EFFA6;">Searching for the 0x41414141 DWORD :</mark>

```ruby
0:000> ed esp 41414141
0:000> s -d 0 L?80000000 41414141
003cb710 41414141 0000006f 80000000 00000007 AAAAo...........
```

When searching for the memory type ==DWORD, we use -d==. Next, we set the ==searching address, which starts at 0==. We then set the length for the command to search. To search the ==whole memory range, we enter L and the value “?80000000”==, which signifies the entire process’s memory space. Finally, we enter the pattern that we want to search for, in this case, 41414141.

Note : Use ***-a*** for ascii

---

## # `Registers & Threads` -

- <mark style="background: #3D7EFFA6;">Inspecting register values </mark> :

```ruby
0:000> r
eax=0008f24c ebx=00000006 ecx=0ad16828 edx=000f5e6c esi=0013f7d0 edi=00000006
eip=751c3b70 esp=0008f228 ebp=0008f25c iopl=0 nv up ei pl nz na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00200206
KERNELBASE!WriteFile:
751c3b70 6a18 push 18h
0:000> r ecx
ecx=0ad16828
```

- <mark style="background: #FFB86CA6;">Dumping a  register</mark> :

```c
dds esp - 8 L7
```

1. `Starting Address` : The starting address is ESP minus 8 bytes. This means you're looking at memory locations that are 8 bytes lower (towards the bottom of the stack) than the current ESP.

2. `Number of Values Displayed` : This command displays the next 7 double words (DWORDs) in memory starting from ESP - 8.


```c
dds esp L3
```

1. `Starting Address` : The starting address is the current ESP value. This means you're looking at memory locations starting from the current top of the stack.

2. `Number of Values Displayed` : This command displays the next 3 double words (DWORDs) in memory starting from ESP.


- <mark style="background: #D2B3FFA6;">Modifying register values</mark> :

```ruby
0:000> r ecx=41414141
0:000> r
eax=0008f24c ebx=00000006 ecx=41414141 edx=000f5e6c esi=0013f7d0 edi=00000006
eip=751c3b70 esp=0008f228 ebp=0008f25c iopl=0 nv up ei pl nz na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00200206
KERNELBASE!WriteFile:
751c3b70 6a18 push 18h
```

- <mark style="background: #E632B3A6;">Display all the Threads</mark> :

```c
0:000> ~
.  0  Id: 1a18.39a8 Suspend: 1 Teb: 00000093`7be39000 Unfrozen
   1  Id: 1a18.1c74 Suspend: 1 Teb: 00000093`7be3b000 Unfrozen
   2  Id: 1a18.eb8 Suspend: 1 Teb: 00000093`7be3d000 Unfrozen
   3  Id: 1a18.1460 Suspend: 1 Teb: 00000093`7be3f000 Unfrozen
```

The `.` shows the current thread.

- <mark style="background: #07E997A6;">Change Thread</mark> :

```c
0:000> ~1s
ntdll!NtWaitForWorkViaWorkerFactory+0x14:
00007ffd`10eb08e4 c3              ret
0:001> ~
#  0  Id: 1a18.39a8 Suspend: 1 Teb: 00000093`7be39000 Unfrozen
.  1  Id: 1a18.1c74 Suspend: 1 Teb: 00000093`7be3b000 Unfrozen
   2  Id: 1a18.eb8 Suspend: 1 Teb: 00000093`7be3d000 Unfrozen
   3  Id: 1a18.1460 Suspend: 1 Teb: 00000093`7be3f000 Unfrozen
```

We are now in Thread 1 context.

---

## # `Display` -

- <mark style="background: #3D7EFFA6;">Display DWORD+ASCII</mark> :

The `dc` command in WinDbg is used to display the contents of memory at a specified address as a sequence of double-word (4-byte) values in hexadecimal format

```c
0:000> dc 7ff742490000
00007ff7`42490000  00905a4d 00000003 00000004 0000ffff  MZ..............
00007ff7`42490010  000000b8 00000000 00000040 00000000  ........@.......
00007ff7`42490020  00000000 00000000 00000000 00000000  ................
00007ff7`42490030  00000000 00000000 00000000 00000100  ................
00007ff7`42490040  0eba1f0e cd09b400 4c01b821 685421cd  ........!..L.!Th
00007ff7`42490050  70207369 72676f72 63206d61 6f6e6e61  is program canno
00007ff7`42490060  65622074 6e757220 206e6920 20534f44  t be run in DOS 
00007ff7`42490070  65646f6d 0a0d0d2e 00000024 00000000  mode....$.......
```

You can use `db` to display as byte too.

---

- <mark style="background: #3D7EFFA6;">Software Breakpoints :</mark>

When placing a software breakpoint, WinDbg temporarily replaces the first opcode of the instruction where we want execution to halt with an ==INT 3== assembly instruction. The advantage of software breakpoints is that we are allowed to set as many as we want.

We start by using `bp` along with the location where we want the ==application to stop==.

After setting our breakpoint, we can use the `bl` command to ==list all the breakpoints== and make sure we are set for our test.

After setting up the desired breakpoints, we have to let ==the execution continue== by issuing the `g` command.

Setting a breakpoint on the WriteFile -

```ruby
0:005> bp kernel32!WriteFile
0:000> bl
 0 e Disable Clear 767ec6d0 0001 (0001) 0:**** KERNEL32!WriteFile
```

During a debugging session, it can also be handy to disable and enable breakpoints using the `bd`(disable) and `be`(enable) commands, respectively. These commands accept the breakpoint numbers listed by `bl` as arguments.

Setting, disabling, listing and clearing breakpoints -

```ruby
0:000> bd 0
0:000> bl
 0 d Enable Clear 767ec6d0 0001 (0001) 0:**** KERNEL32!WriteFile

0:000> be 0
0:000> bl
 0 e Disable Clear 767ec6d0 0001 (0001) 0:**** KERNEL32!WriteFile
```

- <mark style="background: #3D7EFFA6;">Hardware Breakpoints</mark> :

the x86 and x64 architectures ==only use four debug registers==, so unlike software breakpoints, we are limited by the number of processor breakpoints.

To set a hardware breakpoint in WinDbg, we need to pass three arguments to the ba command. The first is the type of access, which can be either e (execute), r (read), or w (write). The second one is the size in bytes for the specified memory access, and finally, the third argument is the memory address where we want to set the breakpoint at.

Setting a hardware breakpoint on execute access :

```c
0:000> ba e 1 kernel32!WriteFile
```

---

- <mark style="background: #3D7EFFA6;">Unresolved Function Breakpoint</mark> :

We can use the `bu` command to ==set a breakpoint on an unresolved function==. This is a function residing in a module that isn’t yet loaded in the process memory space. In this case, the breakpoint will be enabled when the module is loaded and the target function is resolved.

Here is an example of the `bu` command applied to Notepad. The module **OLE32.dll** is not initially loaded in the notepad.exe process, but is loaded once a file is saved. Once WinDbg is attached to the notepad.exe process, we will ==set an unresolved breakpoint on a arbitrary OLE32 function, OLE32!WriteStringStream==.

Unresolved breakpoint on ole32!WriteStringStream -

```ruby
0:005> lm m ole32
Browse full module list

start end module name
0:005> bu ole32!WriteStringStream
0:005> bl
 0 e Disable Clear u 0001 (0001) (ole32!WriteStringStream)
```

After resuming Notepad execution and saving a file, we notice that OLE32.dll has been loaded :

```ruby
0:005> g
[...]
ModLoad: 74ce0000 74dd7000 C:\Windows\System32\ole32.dll
[...]
```

- <mark style="background: #3D7EFFA6;">pointer to data</mark> :

Displays data referenced from a memory address.

```c
0:002> dd esp L1
00faf974 771bab89
0:002> dd 771bab89
771bab89 c03307eb 658bc340 fc45c7e8 fffffffe
771bab99 d0e8006a ccfff955 cccccccc cccccccc
771baba9 cccccccc 8bcccccc ec8b55ff 180d8b64
771babb9 8b000000 81890845 00000f24 0004c25d
771babc9 cccccccc 8bcccccc ec8b55ff 0018a164
771babd9 b0ff0000 00000f24 e80875ff fffc6c77
771babe9 0004c25d cccccccc cccccccc cccccccc
771babf9 cccccccc 8bcccccc ec8b55ff 640875ff
```

```c
0:002> dd poi(esp)
771bab89 c03307eb 658bc340 fc45c7e8 fffffffe
771bab99 d0e8006a ccfff955 cccccccc cccccccc
771baba9 cccccccc 8bcccccc ec8b55ff 180d8b64
771babb9 8b000000 81890845 00000f24 0004c25d
771babc9 cccccccc 8bcccccc ec8b55ff 0018a164
771babd9 b0ff0000 00000f24 e80875ff fffc6c77
771babe9 0004c25d cccccccc cccccccc cccccccc
771babf9 cccccccc 8bcccccc ec8b55ff 640875ff
```

- <mark style="background: #3D7EFFA6;">Step through and Step Into</mark> :

After halting the application flow, we can use `p` and `t` to step over, and into each instruction, respectively.

The `p` command will execute ==one single instruction at a time and steps over function calls==. `t` will do the same, but will also ==step into function calls==.

Another convenient command is `pt` (step to next return), which allows us to ==fast-forward to the end of a function==.

Another command is `ph` that ==executes code until a branching instruction is reached==. This includes conditional or unconditional branches, function calls, and return instructions.

- <mark style="background: #3D7EFFA6;">Converting data</mark> :

By default, WinDbg displays content in hexadecimal format.

Converting to Decimal :

```c
0:002>  ? 2019
Evaluate expression: 8217 = 00000000`00002019
```

Converting decimal number to hexadecimal :

```c
0:002>  ? 0n10
Evaluate expression: 10 = 00000000`0000000a
```

Converting binary to decimal and hexadecimal :

```c
0:002>  ? 0y1010100111110
Evaluate expression: 5438 = 00000000`0000153e
```

All in one :

```c
0:002>  .formats 4141414141414141
Evaluate expression:
  Hex:     41414141`41414141
  Decimal: 4702111234474983745
  Decimal (unsigned) : 4702111234474983745
  Octal:   0405012024050120240501
  Binary:  01000001 01000001 01000001 01000001 01000001 01000001 01000001 01000001
  Chars:   AAAAAAAA
  Time:    Thu May 26 14:27:27.498 16501 (UTC + 5:30)
  Float:   low 12.0784 high 12.0784
  Double:  2.26163e+006
```

---

## # `Information about Binary` :

- <mark style="background: #3D7EFFA6;">Listing modules & Symbols</mark> :

We can issue the `lm` command to display all loaded modules, including their starting and ending addresses in virtual memory space :

```c
0:002> lm
start             end                 module name
00007ff7`42490000 00007ff7`424c8000   NOTEPAD    (pdb symbols)          C:\ProgramData\Dbg\sym\notepad.pdb\5A096A6EA0DB6F42E516FC1B12C514EE3\notepad.pdb
00007ffc`decc0000 00007ffc`ded9d000   efswrt     (deferred)             
00007ffc`f6270000 00007ffc`f631c000   TextShaping   (deferred)             
00007ffc`fcea0000 00007ffc`fcebd000   MPR        (deferred)             
00007ffc`fcf80000 00007ffc`fd07a000   textinputframework   (deferred)             
00007ffc`ff0c0000 00007ffc`ff35a000   COMCTL32   (deferred)             
00007ffd`01f50000 00007ffd`01f79000   srvcli     (deferred)             
00007ffd`02980000 00007ffd`02c3c000   iertutil   (deferred)             
00007ffd`03ac0000 00007ffd`03cc7000   twinapi_appcore   (deferred)             
00007ffd`04230000 00007ffd`0441d000   urlmon     (deferred)             
00007ffd`05860000 00007ffd`058c6000   oleacc     (deferred)             
00007ffd`08b30000 00007ffd`08c24000   MrmCoreR   (deferred)             
00007ffd`0a960000 00007ffd`0aab5000   wintypes   (deferred)
```

- <mark style="background: #FFB86CA6;">Listing only specific modules</mark> :

```c
0:002> lm m kernel*
Browse full module list
start             end                 module name
00007ffd`0cf80000 00007ffd`0cf92000   kernel_appcore   (pdb symbols)          C:\ProgramData\Dbg\sym\Kernel.Appcore.pdb\5E49B3157247A4CEBABE3E86C162BF9C1\Kernel.Appcore.pdb
00007ffd`0e820000 00007ffd`0eb16000   KERNELBASE   (pdb symbols)          C:\ProgramData\Dbg\sym\kernelbase.pdb\2BC82CF7EFF559F455200E5466071BE43\kernelbase.pdb
00007ffd`0f510000 00007ffd`0f5cd000   KERNEL32   (pdb symbols)          C:\ProgramData\Dbg\sym\kernel32.pdb\C8DEC0DDA0E2EF5C882CC32F0AF2F80B1\kernel32.pdb
```

- <mark style="background: #D2B3FFA6;">Listing functions by partial symbol</mark> :

We can learn more about their symbols by using the `x` (examining symbol) command.Below we dumped information regarding the symbols present from the KERNELBASE module. We use the wildcard to display ==all the symbols that start with “CreateProc”== inside Kernelbase :

```c
0:002> x kernelbase!CreateProc*
00007ffd`0e8d7ae8 KERNELBASE!CreateProcessInternalA$filt$1 (void)
00007ffd`0e8d7ac8 KERNELBASE!CreateProcessInternalA$filt$0 (void)
00007ffd`0e8a2bfc KERNELBASE!CreateProcessExtensions::ReleaseAppXContext (void)
00007ffd`0e87a490 KERNELBASE!CreateProcessInternalW (void)
00007ffd`0e879880 KERNELBASE!CreateProcessInternalA (void)
00007ffd`0e8d7c0f KERNELBASE!CreateProcessInternalW$filt$1 (void)
00007ffd`0e8d5db0 KERNELBASE!CreateProcessWithTokenW (void)
00007ffd`0e8d7c35 KERNELBASE!CreateProcessInternalW$fin$2 (void)
00007ffd`0e8d5db0 KERNELBASE!CreateProcessAsUserA (void)
00007ffd`0e8d7ba9 KERNELBASE!CreateProcessInternalW$fin$0 (void)
```

All the function which has main inside notepad will be dumped -

```c
0:000> x notepad!*main* 
00007ff7`424b3cd0 notepad!__scrt_common_main_seh (void)
00007ff7`424b54d8 notepad!`__scrt_common_main_seh'::`1'::filt$0 (void)
00007ff7`4249ad1c notepad!wWinMain (wWinMain)
00007ff7`424b6f78 notepad!_imp__get_wide_winmain_command_line = <no type information>
00007ff7`424b3e50 notepad!wWinMainCRTStartup (wWinMainCRTStartup)
00007ff7`424b6f78 notepad!_imp__o__get_wide_winmain_command_line = <no type information>
00007ff7`424b4d80 notepad!get_wide_winmain_command_line (_get_wide_winmain_command_line)
00007ff7`424b4d80 notepad!o__get_wide_winmain_command_line (_o__get_wide_winmain_command_line)
```

- <mark style="background: #E632B3A6;">Display source code line assosiciated with the address</mark> -

Its the exact opposite of `x` command :

```c
0:000> ln 00007ff7`4249ad1c
Browse module
Set bu breakpoint

(00007ff7`4249ad1c)   notepad!wWinMain   |  (00007ff7`4249b0e0)   notepad!UpdateStatusBar
Exact matches:
```

---

## # `Call Stack` :

- <mark style="background: #3D7EFFA6;">Dumping Call Stack of current thread</mark> :

```c
0:000> k
 # Child-SP          RetAddr               Call Site
00 00000093`7bd2eed0 00007ffd`10ee3bda     ntdll!LdrpDoDebuggerBreak+0x30
01 00000093`7bd2ef10 00007ffd`10e84dbb     ntdll!LdrpInitializeProcess+0x1eda
02 00000093`7bd2f330 00007ffd`10e84c43     ntdll!LdrpInitialize+0x15f
03 00000093`7bd2f3d0 00007ffd`10e84bee     ntdll!LdrpInitialize+0x3b
04 00000093`7bd2f400 00000000`00000000     ntdll!LdrInitializeThunk+0xe
```

You can further click on the the number(stack frame) for dumping local variables.

- <mark style="background: #FFB86CA6;">Shown arguments to child</mark> :

```c
0:000> kvn
 # Child-SP          RetAddr               : Args to Child                                                           : Call Site
00 00000093`7bd2eed0 00007ffd`10ee3bda     : 00007ffd`10f35a00 00000000`00000010 00000000`00000010 00000000`00000010 : ntdll!LdrpDoDebuggerBreak+0x30
01 00000093`7bd2ef10 00007ffd`10e84dbb     : 00000000`00000001 00000000`00000000 00000000`00000000 00000000`00000001 : ntdll!LdrpInitializeProcess+0x1eda
02 00000093`7bd2f330 00007ffd`10e84c43     : 00000000`00000000 00007ffd`10e10000 00000000`00000000 00000093`7be39000 : ntdll!LdrpInitialize+0x15f
03 00000093`7bd2f3d0 00007ffd`10e84bee     : 00000093`7bd2f450 00000000`00000000 00000000`00000000 00000000`00000000 : ntdll!LdrpInitialize+0x3b
04 00000093`7bd2f400 00000000`00000000     : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : ntdll!LdrInitializeThunk+0xe
```

- <mark style="background: #E632B3A6;">Stack memory taken by a frame</mark> :

```c
0:000> kf
 #   Memory  Child-SP          RetAddr               Call Site
00           00000093`7bd2eed0 00007ffd`10ee3bda     ntdll!LdrpDoDebuggerBreak+0x30
01        40 00000093`7bd2ef10 00007ffd`10e84dbb     ntdll!LdrpInitializeProcess+0x1eda
02       420 00000093`7bd2f330 00007ffd`10e84c43     ntdll!LdrpInitialize+0x15f
03        a0 00000093`7bd2f3d0 00007ffd`10e84bee     ntdll!LdrpInitialize+0x3b
04        30 00000093`7bd2f400 00000000`00000000     ntdll!LdrInitializeThunk+0xe
```

---

- <mark style="background: #3D7EFFA6;">Detail Analysis of a dump/debugging</mark> :

```c
0:000> !analyze -v
*******************************************************************************
*                                                                             *
*                        Exception Analysis                                   *
*                                                                             *
*******************************************************************************

*** WARNING: Check Image - Checksum mismatch - Dump: 0x1f6b42, File: 0x1f5f3e - C:\Symbols\ntdll.dll\FEEF31D31f8000\ntdll.dll

KEY_VALUES_STRING: 1

    Key  : Analysis.CPU.mSec
    Value: 1733

    Key  : Analysis.Elapsed.mSec
    Value: 13957

    Key  : Analysis.IO.Other.Mb
    Value: 0

    Key  : Analysis.IO.Read.Mb
    Value: 0

    Key  : Analysis.IO.Write.Mb
    Value: 2

    Key  : Analysis.Init.CPU.mSec
    Value: 264

    Key  : Analysis.Init.Elapsed.mSec
    Value: 678302

    Key  : Analysis.Memory.CommitPeak.Mb
    Value: 80

    Key  : Failure.Bucket
    Value: BREAKPOINT_80000003_ntdll.dll!LdrpDoDebuggerBreak

    Key  : Failure.Hash
    Value: {06f54d4d-201f-7f5c-0224-0b1f2e1e15a5}

    Key  : Timeline.OS.Boot.DeltaSec
    Value: 614010

    Key  : Timeline.Process.Start.DeltaSec
    Value: 675

    Key  : WER.OS.Branch
    Value: vb_release

    Key  : WER.OS.Version
    Value: 10.0.19041.1

    Key  : WER.Process.Version
    Value: 10.0.19041.3393


NTGLOBALFLAG:  70

PROCESS_BAM_CURRENT_THROTTLED: 0

PROCESS_BAM_PREVIOUS_THROTTLED: 0

APPLICATION_VERIFIER_FLAGS:  0

EXCEPTION_RECORD:  (.exr -1)
ExceptionAddress: 00007ffd10ee0750 (ntdll!LdrpDoDebuggerBreak+0x0000000000000030)
   ExceptionCode: 80000003 (Break instruction exception)
  ExceptionFlags: 00000000
NumberParameters: 1
   Parameter[0]: 0000000000000000

FAULTING_THREAD:  000039a8

PROCESS_NAME:  notepad.exe

ERROR_CODE: (NTSTATUS) 0x80000003 - {EXCEPTION}  Breakpoint  A breakpoint has been reached.

EXCEPTION_CODE_STR:  80000003

EXCEPTION_PARAMETER1:  0000000000000000

STACK_TEXT:  
00000093`7bd2eed0 00007ffd`10ee3bda     : 00007ffd`10f35a00 00000000`00000010 00000000`00000010 00000000`00000010 : ntdll!LdrpDoDebuggerBreak+0x30
00000093`7bd2ef10 00007ffd`10e84dbb     : 00000000`00000001 00000000`00000000 00000000`00000000 00000000`00000001 : ntdll!LdrpInitializeProcess+0x1eda
00000093`7bd2f330 00007ffd`10e84c43     : 00000000`00000000 00007ffd`10e10000 00000000`00000000 00000093`7be39000 : ntdll!LdrpInitialize+0x15f
00000093`7bd2f3d0 00007ffd`10e84bee     : 00000093`7bd2f450 00000000`00000000 00000000`00000000 00000000`00000000 : ntdll!LdrpInitialize+0x3b
00000093`7bd2f400 00000000`00000000     : 00000000`00000000 00000000`00000000 00000000`00000000 00000000`00000000 : ntdll!LdrInitializeThunk+0xe


STACK_COMMAND:  ~0s ; .cxr ; kb

SYMBOL_NAME:  ntdll!LdrpDoDebuggerBreak+30

MODULE_NAME: ntdll

IMAGE_NAME:  ntdll.dll

FAILURE_BUCKET_ID:  BREAKPOINT_80000003_ntdll.dll!LdrpDoDebuggerBreak

OS_VERSION:  10.0.19041.1

BUILDLAB_STR:  vb_release

OSPLATFORM_TYPE:  x64

OSNAME:  Windows 10

IMAGE_VERSION:  10.0.19041.3393

FAILURE_ID_HASH:  {06f54d4d-201f-7f5c-0224-0b1f2e1e15a5}

Followup:     MachineOwner
---------
```

- <mark style="background: #3D7EFFA6;">Generating a dump</mark> :

```c
.dump /ma C:\Dump.dmp 
```

1. `/ma` : mini dump with full memory. 

## # `Extensions` :

- <mark style="background: #3D7EFFA6;">Current loaded extensions</mark> -

```c
0:000> .chain
Extension DLL search Path:
    C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\WINXP;C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\winext;C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\winext\arcade;C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\pri;C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64;C:\Users\napst\AppData\Local\Dbg\EngineExtensions;C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64;C:\Program Files (x86)\Common Files\Oracle\Java\javapath;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\iCLS\;C:\Program Files\Intel\Intel(R) Management Engine Components\iCLS\;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0\;C:\WINDOWS\System32\OpenSSH\;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\DAL;C:\Program Files\Intel\Intel(R) Management Engine Components\DAL;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\IPT;C:\Program Files\Intel\Intel(R) Management Engine Components\IPT;C:\Users\napst\AppData\Local\Programs\Python\Python37-32\Scripts\;C:\Users\napst\AppData\Local\Programs\Python\Python37-32\;C:\Users\napst\AppData\Local\Microsoft\WindowsApps
Extension DLL chain:
    ext: image 10.0.25921.1001, API 1.0.0, 
        [path: C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\winext\ext.dll]
    DbgEngCoreDMExt: image 10.0.25921.1001, API 0.0.0, 
        [path: C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\winext\DbgEngCoreDMExt.dll]
    dbghelp: image 10.0.25921.1001, API 10.0.6, 
        [path: C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\dbghelp.dll]
    exts: image 10.0.25921.1001, API 1.0.0, 
        [path: C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\WINXP\exts.dll]
    uext: image 10.0.25921.1001, API 1.0.0, 
        [path: C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\winext\uext.dll]
    ntsdexts: image 10.0.25921.1001, API 1.0.0, 
        [path: C:\Program Files\WindowsApps\Microsoft.WinDbg_1.2308.2002.0_x64__8wekyb3d8bbwe\amd64\WINXP\ntsdexts.dll]
```

- <mark style="background: #FFB86CA6;">Loading an extension</mark> -

```c
0:000> .load <path of extension>
```

Check if your extension is loaded with `.chain` after.


- <mark style="background: #D2B3FFA6;">Unloading an extension</mark> -

```c
0:000> .unload <path of extension>
```

---

## # `Cheatsheet` -

##### ## <mark style="background: #3D7EFFA6;">WinDBG Command Line Options</mark> -

| Option | Description                                 |
|--------|---------------------------------------------|
| <mark style="background: #FFB86CA6;">-Q</mark> | Suppresses prompt for saving workspace                                           |
| <mark style="background: #D2B3FFA6;">-y</mark> |  Path to symbols, symbol server                                                   |
| <mark style="background: #E632B3A6;">-srcpath</mark> |  Source files directory path                                                |
| <mark style="background: #07E997A6;">-b</mark> |  Debugger breaks into target system upon connection and immediately after reboot  |
| <mark style="background: #FF5582;">-g</mark> |  Ignores initial breakpoint in target application                                 |
| <mark style="background: #07E2E96E;">-z</mark> |  Path to crash dump used for post-mortem debugging                                |
| <mark style="background: #FF9255;">-snul</mark> |  Restricts symbol search to loaded modules only                                |
| <mark style="background: #FFB86CA6;">-p</mark> |  Specifies the decimal process ID to be debugged. This is used to debug a process that is already running |                                                             |
| <mark style="background: #D2B3FFA6;">-k</mark> |  Specified options for kernel debugging                                           |
| <mark style="background: #E632B3A6;">-QSY</mark> |  Automatically reload source files (suppresses reload prompt)                   |
| <mark style="background: #07E997A6;">-c</mark> |  Specifies the initial debugger command to run at start-up                        |

##### ## <mark style="background: #3D7EFFA6;">General Commands</mark> -

| Option | Description                                 |
|--------|---------------------------------------------|
| <mark style="background: #FFB86CA6;">cls</mark> |   Clears the debugger’s command screen                                           |
| <mark style="background: #D2B3FFA6;">vertarget</mark> |   Displays OS version, system uptime and debug time                        |
| <mark style="background: #E632B3A6;">vercommand</mark> |   Displays command line passed to the debugger                            |
| <mark style="background: #07E997A6;">.logopen</mark> |   Writes the subsequent contents of the debugger command window to the specified logfile overwriting its contents |                                     |
| <mark style="background: #FF5582;">.logclose</mark> |   Closes the existing logfile (if any)                                     |
| <mark style="background: #07E2E96E;">.logappend</mark> |  Writes the subsequent contents of the debugger command window to the specified logfile without overwriting its contents |                              |
| <mark style="background: #FF9255;">.logfile</mark> |  Determines whether a log file exists and displays the file's status       |
| <mark style="background: #FFB86CA6;">.pcmd</mark> |  Causes a command to be issued when the debugger prompt is displayed          |
| <mark style="background: #D2B3FFA6;">.write_cmd_hist</mark> |  Writes Command history to file (in reverse chronological order)    |
| <mark style="background: #E632B3A6;">.wtitle</mark> |  Sets the debuggers window title                                            |
| <mark style="background: #07E997A6;">.shell</mark> |  Executes a shell program, redirects the debuggers output to the program and displays the output of the program in the debugger |

##### ## <mark style="background: #3D7EFFA6;">Symbol File Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">.sympath</mark> |  Sets / Queries the symbol search path |
| <mark style="background: #D2B3FFA6;">!lmi</mark> |  Displays symbol information about the module |
| <mark style="background: #E632B3A6;">.symfix</mark> |  Sets the symbol path to point to the Microsoft public symbol server |
| <mark style="background: #07E997A6;">!sym noisy/quiet</mark> |  Enables/Disables verbose symbol loading |
| <mark style="background: #FF5582;">.reload</mark> |  Forces debugger to reload the symbols for all modules |
| <mark style="background: #07E2E96E;">!chksym</mark> |  Checks .PDB for a module and validates it |
| <mark style="background: #FF9255;">.symopt</mark> |  Enables/disables symbol options |
| <mark style="background: #FFB86CA6;">lm</mark> |  List Modules and their symbol status |
| <mark style="background: #D2B3FFA6;">ld</mark> |  Loads symbols for the specified module and updates all module information.Same as .reload –f and .symopt- 0x4 |

##### ## <mark style="background: #3D7EFFA6;">Symbol Usage Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">x</mark>  | Displays the address of the symbol in the specified module|
| <mark style="background: #D2B3FFA6;">ln</mark> |  List symbols near the given address|
| <mark style="background: #E632B3A6;">dps</mark> |  Displays contents of the specified address range and maps the contents to symbols|
| <mark style="background: #07E997A6;">dv</mark> |  Displays local variables and functions parameters for current stack frame. Requires private symbols.|
| <mark style="background: #FF5582;">dt</mark> |  Displays structure type information|
| <mark style="background: #07E2E96E;">.typeopt</mark> |  Controls Display of variables in Watch and Locals windows|
| <mark style="background: #FF9255;">.symopt</mark> |  Controls symbol options|
| <mark style="background: #FFB86CA6;">.frame/.f+/.f-</mark> | Changes or displays the local context (scope) to be used to interpret local variables |
| <mark style="background: #D2B3FFA6;">k</mark> |  Display call stack of the current thread|

##### ## <mark style="background: #3D7EFFA6;">Executable Image Commands</mark> -

| Command | Description |
|---|----|
| <mark style="background: #FFB86CA6;">!dh</mark> | Displays the Portable Executable (PE) header information of a module |
| <mark style="background: #D2B3FFA6;">lmv</mark> |  Display the start and end load address of modules |
| <mark style="background: #D2B3FFA6;">!chkimg</mark> |  Check for corruptions in the copy of an executable loaded in memory against the binary image from the symbol server or executable file path |
| <mark style="background: #E632B3A6;">.imgscan</mark> |  Scans user VAS for PE image headers and displays them |
| <mark style="background: #07E997A6;">!imgreloc</mark> |  Displays information about modules inside a process that have been relocated from their preferred base addresses |
| <mark style="background: #FF5582;">!dlls</mark> |  Display information about DLLs loaded into a process |

##### ## <mark style="background: #3D7EFFA6;">Extension DLL Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">.chain</mark> | Prints information on all currently loaded extension DLLs |
| <mark style="background: #D2B3FFA6;">.extpath</mark> |  Sets the extension DLL search path |
| <mark style="background: #E632B3A6;">.load</mark> |  Display words values(16 bit) |
| <mark style="background: #07E997A6;">.loadby</mark> |  Loads a new extension DLL into the debugger |
| <mark style="background: #FF5582;">.unload</mark> |  Unloads an extension DLL from the debugger |
| <mark style="background: #07E2E96E;">.unloadall</mark> |  Unloads all extension DLLs from the debugger |
| <mark style="background: #FF9255;">.setdll</mark> |  Changes the default extension DLL used by the debugger |
| <mark style="background: #FFB86CA6;">.extmatch</mark> |  Show exported functions of the given extension DLL |

##### ## <mark style="background: #3D7EFFA6;">Memory Display Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">db</mark> |  Display byte values and ASCII characters (8 bit) |
| <mark style="background: #D2B3FFA6;">dW</mark> |  Display words and wide-char characters (16 bit) |
| <mark style="background: #E632B3A6;">dw</mark> |  Display words values (16 bit) |
| <mark style="background: #07E997A6;">dd</mark> |  Display double word values (32 bit) |
| <mark style="background: #FF5582;">dq</mark> |  Display quad words values (64 bit) |
| <mark style="background: #07E2E96E;">dp</mark> |  Display pointer values (32 bit on x86 and 64 bit on x64) |
| <mark style="background: #FF9255;">dps</mark> |  Display pointer values and resolve them to symbols |
| <mark style="background: #FFB86CA6;">dpa</mark> |  Display pointer values and the ASCII string they point to |
| <mark style="background: #D2B3FFA6;">dpu</mark> |  Display pointer values and the Unicode string they point to |
| <mark style="background: #E632B3A6;">da</mark> |  Display a NULL terminated ASCII string |
| <mark style="background: #07E997A6;">du</mark> |  Display a NULL terminated wide-char string |
| <mark style="background: #FF5582;">ds</mark> |  Display an ANSI_STRING structure |
| <mark style="background: #07E2E96E;">dS</mark> |  Display an UNICODE_STRING structure |
| <mark style="background: #FF9255;">dc</mark> |  Display double word values and ASCII characters |

##### ## <mark style="background: #3D7EFFA6;">Memory Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">s</mark> | Searches memory for the specified pattern |
| <mark style="background: #D2B3FFA6;">c</mark> |  Compares contents of memory blocks |
| <mark style="background: #E632B3A6;">f</mark> |  Fills memory with a pattern |
| <mark style="background: #07E997A6;">m</mark> |  Moves memory |
| <mark style="background: #FF5582;">poi</mark> |  Returns pointer-sized data from the specified address |
| <mark style="background: #07E2E96E;">wo, dwo, qwo</mark> |  Returns a word, dword or qword respectively from the specified address |
| <mark style="background: #FF9255;">.writemem</mark> |  Writes contents of a memory range to a file |
| <mark style="background: #FFB86CA6;">.readmem</mark> |  Reads the contents of a file into a memory range |
| <mark style="background: #D2B3FFA6;">.holdmem</mark> |  Hold and Compare Memory (used if memory contents change) |

##### ## <mark style="background: #3D7EFFA6;">Debugger Breakpoint Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">ba</mark> | Sets a data breakpoint ( breakpoint on access ) |
| <mark style="background: #D2B3FFA6;">bc</mark> |  Clears a previously set breakpoint |
| <mark style="background: #E632B3A6;">be</mark> |  Enables a previously set breakpoint |
| <mark style="background: #07E997A6;">bd</mark> |  Disables a previously set breakpoint |
| <mark style="background: #FF5582;">bl</mark> |  Lists all breakpoints (including ones that are disabled) |
| <mark style="background: #07E2E96E;">bp</mark> |  Sets an execution breakpoint on an address |
| <mark style="background: #FF9255;">bu</mark> |  Sets an execution breakpoint on a symbol |
| <mark style="background: #FFB86CA6;">bm</mark> |  Sets multiple execution breakpoints based on wildcard |
| <mark style="background: #D2B3FFA6;">.bpcmds</mark> |  Displays the commands that were used to set the breakpoints |

##### ## <mark style="background: #3D7EFFA6;">Execution Control Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">g</mark> |  Continues instruction execution |
| <mark style="background: #D2B3FFA6;">gu</mark> |  Step out of the current function |
| <mark style="background: #E632B3A6;">gc</mark> |  Resumes execution from a conditional breakpoint |
| <mark style="background: #07E997A6;">p/t</mark> |  Step (skip over function calls) / Trace (trace into function calls) |
| <mark style="background: #FF5582;">pa/ta</mark> |  Steps / Traces through instructions till the specified address |
| <mark style="background: #07E2E96E;">pb/tb</mark> |  Steps / Traces through instructions till a branch instruction |
| <mark style="background: #FF9255;">pc/tc</mark> |  Steps / Traces through instructions till the next call |
| <mark style="background: #FFB86CA6;">pt/tt</mark> |  Steps / Traces through instructions till the next ret |
| <mark style="background: #D2B3FFA6;">pct/tct</mark> |  Steps / Traces through instructions till the next ret or call |
| <mark style="background: #E632B3A6;">wt</mark> |  Executes instructions and displays statistics |
| <mark style="background: #07E997A6;">.prompt_allow</mark> | Controls the information that is displayed along with the debugger prompt while single stepping or tracing through code |
| <mark style="background: #FF5582;">.suspend_ui</mark> |  Suspends the refresh of WinDbg debugging information windows while single stepping through code |
| <mark style="background: #07E2E96E;">.step_filter</mark> |  Creates a list of functions that are skipped when tracing through source code |

##### ## <mark style="background: #3D7EFFA6;">Stack Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">k, kb, kp, kP, kv</mark> | Displays stack back trace |
| <mark style="background: #D2B3FFA6;">dv, x -v</mark> |  Displays local variables (private symbols required) |
| <mark style="background: #E632B3A6;">.frame</mark> |  Displays / Sets the function context for local variables |
| <mark style="background: #07E997A6;">.kframes</mark> |  Sets the debugger’s stack frame display depth (default 255) |
| <mark style="background: #FF5582;">~*kvn</mark> |  Displays call stacks for all threads in a process |
| <mark style="background: #07E2E96E;">!uniqstack</mark> |  Displays thread stacks in a process that are not duplicates |
| <mark style="background: #FF9255;">!findstack</mark> |  Displays all stacks that contain the specified symbol inside a process |
| <mark style="background: #FFB86CA6;">kv = Address</mark> |  Displays the stack using Address as the frame pointer |
| <mark style="background: #D2B3FFA6;">!teb</mark> |  Displays the commit limits of the current thread’s user mode stack |
| <mark style="background: #E632B3A6;">dps @esp</mark> |  Displays the raw contents of the call stack |

##### ## <mark style="background: #3D7EFFA6;">Memory Edit Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">eb</mark> | Edit byte (8 bit) values |
| <mark style="background: #D2B3FFA6;">ew</mark> |  Edit word (16 bit) values |
| <mark style="background: #E632B3A6;">ed</mark> |  Edit double word (32 bit) values |
| <mark style="background: #07E997A6;">eq</mark> |  Edit quad word (64 bit) values |
| <mark style="background: #FF5582;">ep</mark> |  Display pointer (32 bit on x86 and 64 bit on x64) values |
| <mark style="background: #07E2E96E;">ea</mark> |  Edit ASCII string (not NULL-terminated) |
| <mark style="background: #FF9255;">eza</mark> |  Edit ASCII string (NULL-terminated) |
| <mark style="background: #FFB86CA6;">eu</mark>  | Edit Unicode string (not NULL-terminated) |
| <mark style="background: #D2B3FFA6;">ezu</mark> |  Edit Unicode string (NULL-terminated) |

##### ## <mark style="background: #3D7EFFA6;">Source Code Commands</mark> -

| Command | Description|
|---|---|
| <mark style="background: #FFB86CA6;">.srcpath</mark> | Sets / Queries the source search path |
| <mark style="background: #D2B3FFA6;">.lines</mark> |  Toggle Source Line Support |
| <mark style="background: #E632B3A6;">.srcfix/.lsrcfix</mark> |  Automatically set the source path to indicate that a source server will be used |
| <mark style="background: #07E997A6;">.srcnoisy</mark> |  Controls the verbosity of source file loading |
| <mark style="background: #FF5582;">.open</mark> |  Searches the source path for a source file and opens this file. |
| <mark style="background: #07E2E96E;">l (lower case L)</mark> |  Set the source line options that control source display and program stepping |
| <mark style="background: #FF9255;">ls/lsa</mark> |  Display a series of lines from the current source file and advance the current source line number |
| <mark style="background: #FFB86CA6;">lsc</mark> |  Displays the current source file name and line number. |
| <mark style="background: #D2B3FFA6;">lse</mark> |  Opens an editor (WinDBG or external) for the current source file |
| <mark style="background: #E632B3A6;">lsf</mark> |  Load or unload a source file |
| <mark style="background: #07E997A6;">lsp</mark> |  Controls the number of source lines displayed while single stepping through code or by the ls/lsa command |

##### ## <mark style="background: #3D7EFFA6;">Script Keywords</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">.for</mark> | Implement loops with initialization, condition and step parameters |
| <mark style="background: #D2B3FFA6;">.break</mark> |  Break out of a .for/.while/.do loop |
| <mark style="background: #E632B3A6;">.continue</mark> |  Used to skip the remaining part of loop for the current iteration. |
| <mark style="background: #07E997A6;">.if</mark> |  Used to execute a block of statements conditionally |
| <mark style="background: #FF5582;">.block</mark> |  Implements a block to enclose statements like {} in C. |
| <mark style="background: #07E2E96E;">.foreach</mark> |  Parses and iterates over the output of debugger command, string or file contents |
| <mark style="background: #FF9255;">.echo</mark> |  Displays a string |
| <mark style="background: #FFB86CA6;">.printf</mark> |  Formats and displays variables and strings like printf() in C. |
| <mark style="background: #D2B3FFA6;">.else</mark> |  Used with .if to enclose statements to be executed if the condition evaluates to a false|
| <mark style="background: #E632B3A6;">.elsif</mark> |  Used to replace a .else followed by a .if |
| <mark style="background: #07E997A6;">.catch</mark> |  Prevents a program from terminating if an error occurs. |
| <mark style="background: #FF5582;">.leave</mark> |  Exits from a .catch block. |
| <mark style="background: #07E2E96E;">.while</mark> |  Implement loops with a condition |

##### ## <mark style="background: #3D7EFFA6;">Disassembler Commands</mark> -

| Command | Description |
|---|---|
| <mark style="background: #FFB86CA6;">u</mark> | Disassembles a few instructions starting at a specific address using linear scan |
| <mark style="background: #D2B3FFA6;">ub</mark> |  Disassembles backwards starting at a specific address |
| <mark style="background: #E632B3A6;">uf</mark> |  Disassembles an entire function, given any address within the function |
| <mark style="background: #07E997A6;">uf /c</mark> |  Displays only the call instructions in a routine instead of the full disassembly |
| <mark style="background: #FF5582;">.asm</mark> |  Specifies assembly display options |
| <mark style="background: #07E2E96E;">#</mark> |  Searches for specific disassembly patterns |

