## # `Code Injection & Api Hooking` -

Malware authors utilize code injection to hide extracted code into other processes. This makes it harder for incident responders and analysts to locate malicious code. Malware also uses code injection to implement rootkits. These user-mode rootkits hook into system APIs to interferewith the normal flow of information within the infected process. Here are some common Windows API calls used by malware authors to inject code into processes:

- CreateToolhelp32Snapshot
- Process32First
- Process32Next
- EnumProcess
- OpenProcess
- CreateProcess
- WriteProcessMemory
- CreateRemoteThread
- GetModuleHandle
- GetProcAddress
- CreateRemoteThread

A common method of `injecting code into another process` is:

<mark style="background: #3D7EFFA6;">Createtoolhelp32Snapshot</mark> -> <mark style="background: #FFB86CA6;">Find Process Handle</mark> -> <mark style="background: #D2B3FFA6;">OpenProcess</mark> -> <mark style="background: #E632B3A6;">VirtualAllocEx</mark> -><mark style="background: #07E997A6;">WriteProcessMemory</mark> -> 

==CreateRemoteThread==

Another method is to force another process to load a `malicious .dll` :

<mark style="background: #3D7EFFA6;">OpenProcess</mark> -> <mark style="background: #FFB86CA6;">VirtualAllocEx</mark> -> <mark style="background: #D2B3FFA6;">WriteProcessMemory</mark> (write .dll location) -><mark style="background: #E632B3A6;">GetModuleHandle</mark> (find kernel32.dll) -> 

<mark style="background: #07E997A6;">GetProcAddress</mark> (find LoadLibrary) -><mark style="background: #3D7EFFA6;">CreateRemoteThread</mark> (execute LoadLibrary with .dll location as an arguemnt)

---

Usage of APIs is not necessarily malware you need to analyze: 

1. Context 
2. Parameters supplied to APIs 
3. Sets of APIs used in sequence

