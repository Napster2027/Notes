## # `Tools for Behavioural Analysis` -

- <mark style="background: #FFB86CA6;">Process Hacker</mark> - open-source tool; GUI designed to help analysts monitor system resources, debug software, and detect malware - replacement for Task Manager
- <mark style="background: #D2B3FFA6;">Process Monitor</mark> - Sysinternal tool, shows real-time file system, registry, and process/thread activity - records all observed actions in a log file
- <mark style="background: #E632B3A6;">RegShot</mark> - highlights changes to the file system and the registry
- <mark style="background: #07E997A6;">ProcDOT</mark>: Visualizes Process Monitor logs for easier analysis.
- <mark style="background: #FF5582;">Wireshark</mark>- Application that captures and analyzes network packets
- <mark style="background: #07E2E96E;">fakedns/Inetsim</mark> - a tool used to emulate the common protocols HTTPS, SMTP, FTP, POP3, TFTP, and IRC(config: /etc/inetsim/inetsim.conf ; log: /var/log/inetsim)
- <mark style="background: #FF9255;">TcpLogView</mark> - maintains a historical log of local TCP connections, showing which process handled which connection

## # `API Patterns in Malware` -

Dynamic Linked Libraries (DLLs) are also a popular file type for malware authors. Unlike .exe files, .dll files have the ability export multiple functions, and are not runnable on their own. DLLs haveno entry point, malicious .dll files usually have an exported function that is used as the entrypoint given a specific set of arguments.

 Most malware do not use the actual address of a function contained within a.dll, they use the `ordinal` value. ==Ordinal values are an integer reference to a specific functionwithin a .dll==. Malware authors commonly use these values to obfuscate their usage of the .dll, making it more challenging for an analyst to decipher the relevance of the function.

### <mark style="background: #3D7EFFA6;">Api in Dropper</mark> -

A dropper is a family of malware where the rest of the files required to conduct further infection of the target device is embedded within the executable. You can use these Windows API calls to begin fingerprinting droppers :

- <mark style="background: #FFB86CA6;">FindResource</mark>
- <mark style="background: #D2B3FFA6;">LoadResource</mark>
- <mark style="background: #E632B3A6;">SizeofResource</mark>
- <mark style="background: #07E997A6;">LockResource</mark> - Windows API call to obtain a pointer to a resource
- <mark style="background: #FF5582;">WriteFile</mark>
- <mark style="background: #07E2E96E;">CreateProcess</mark> - Windows API call to create a new process; references to this function may reveal other processes spawned by a malware specimen.
- <mark style="background: #FF9255;">CreateMutexA</mark> - Windows API commonly used by malware writers to signify that a device has already been infected; creates a mutex.

### <mark style="background: #3D7EFFA6;">Api to monitor user activities</mark> -

Malware can also be used to monitor a user's activities. These are common Windows APIs used by malware authors to monitor keys, windows, and the clipboard:

- <mark style="background: #FFB86CA6;">GetKeyState</mark> - Windows API call to retrieve the status of a specified key
- <mark style="background: #D2B3FFA6;">GetAsyncKeyState</mark> - Windows API call to determine if a key is currently up or down, or if it was pressed since the last call to this API.
- <mark style="background: #E632B3A6;">GetWindowText</mark> - Windows API call to obtain the text of a window's title bar
- <mark style="background: #07E997A6;">OpenClipboard</mark> - Windows API call to get access to the clipboard and ensure other applications don't modify the clipboard data
- <mark style="background: #FF5582;">GetClipboardData</mark> - Windows API call to gather data from the clipboard; malware authors use this call to acquire usernames / passwords being copy / pasted.
- <mark style="background: #07E2E96E;">CloseClipboard</mark>

## # `Dynamic Analysis Workflow` -

1. Start procmon, then pause and clear
2. Start Fakenet
3. Start Regshot, then take 1st shot
4. Once 1st shot completes, Resume procmon
5. Run Malware for about 1 – 3 mins and study fakenet output
6. After about 3 mins pause procmon
7. Use Regshot, to take 2nd shot
8. Once 2nd shot completes, click Compare->Compare and show output
9. Study Regshot output
10. In procmon apply these filters:
 • ProcessName is: malware-name
 • Operation is:
	 • WriteFile
	 • SetDispositionInformationFile
	 • RegSetValue
	 • ProcessCreate
	 • TCP
	 • UDP
11. Save the file and use Procdot to visualize it.

## # `Network Analysis` -

• Fakenet will save a pcap file in the logs folder
• Use wireshark to open it
• Filter out http
• Trace the TCP stream

